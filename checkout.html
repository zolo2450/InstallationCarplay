<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout - Panier</title>
 <link rel="shortcut icon" href="./WhatsApp_Image_2025-05-31_√†_17.59.45_7f2ed762-removebg-preview.png">
 <link rel="stylesheet" href="./css/style.css">
 <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">
 <link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>
 <link type="text/css" rel="stylesheet" href="css/slick.css"/>
 <link type="text/css" rel="stylesheet" href="css/slick-theme.css"/>
 <link type="text/css" rel="stylesheet" href="css/nouislider.min.css"/>
 <link rel="stylesheet" href="css/font-awesome.min.css">
  
</head>
<style>
    h1, h3, h4 {
      color: #CC3300;
    }
    h1 {
      text-transform: uppercase;
      font-size: 1.6em;
      line-height: 2em;
      margin-bottom: 1em;
      text-align: center;
    }
    h3 {
      text-transform: uppercase;
      font-size: 1.4em;
      line-height: 2em;
      margin-bottom: 0.5em;
    }
    h4 {
      line-height: 3.5em;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      margin-bottom: 1.5em;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgb(204 51 0 / 0.2);
    }
    th, td {
      padding: 0.7em 0.5em;
      text-align: center;
      background: #fff;
      font-size: 0.95em;
    }
    th {
      color: #CC3300;
      font-weight: 700;
    }

    .total {
      font-weight: bold;
      font-size: 1.2em;
      text-align: right;
      margin-bottom: 20px;
      color: #444;
    }

    .empty-cart {
      text-align: center;
      font-size: 1.2em;
      margin-top: 50px;
      color: #666;
    }

    ul {
      list-style-type: none;
    }

    li {
      margin-bottom: 0.8em;
      zoom: 1;
    }
    li:after {
      content: "";
      display: table;
      clear: both;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea {
      border: 1px solid #CC3300;
      padding: 0.7em;
      height: 3em;
      width: 100%;
      border-radius: 6px;
      font-size: 1em;
      color: #333;
      margin-top: 0.3em;
    }

    textarea {
      height: 5em;
      resize: vertical;
    }

    [type="checkbox"] {
      width: auto;
      height: 100%;
    }

    label {
      display: block;
      font-size: 0.9em;
      font-weight: bold;
      color: #444;
      margin-top: 1em;
    }

    button {
      font-size: 1em;
      font-weight: bold;
      background: #CC3300;
      border-radius: 0.25em;
      color: #fff;
      width: 50%;
      min-width: 12em;
      max-width: 16em;
      margin: 1.5em auto;
      display: block;
      border: none;
      cursor: pointer;
      padding: 0.8em 1em;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #a62a00;
    }

    .promo-section, .coords-section {
      border: 1px solid #dedede;
      padding: 1.5em;
      margin-bottom: 1.5em;
      border-radius: 12px;
      background-color: #f9f9f9;
    }

    .message {
      margin-top: 10px;
      font-weight: bold;
      text-align: center;
    }
    .message.error {
      color: red;
    }
    .message.success {
      color: green;
    }
  </style>

<body>

<header>
  <div id="top-header">
    <div class="container">
      <ul class="header-links pull-left">
        <li><a href="#"><i class="fa fa-phone"></i> +33 7 49 94 41 32</a></li>
        <li><a href="#"><i class="fa fa-envelope-o"></i> contact95190@gmail.com</a></li>
        <li><a href="#"><i class="fa fa-map-marker"></i>  Goussainville 95190</a></li>
      </ul>
      <ul class="header-links pull-right">
      </ul>
    </div>
  </div>

  <div id="header">
    <div class="container">
      <div class="row align-items-center">

        <div class="col-md-3">
          <div class="header-logo">
            <a href="./index.html" class="logo">
              <img src="./WhatsApp_Image_2025-05-31_√†_17.59.45_7f2ed762-removebg-preview.png" width="150px" alt="">
            </a>
          </div>
        </div>

        <div class="col-md-6 text-center d-flex align-items-center justify-content-center">
          <h1 style="font-size: 2.0rem; margin: 0; color: white;">
            <br>
          </h1>
        </div>

        <div class="col-md-3 clearfix">
          <div class="header-ctn d-flex justify-content-end align-items-center">
       <div class="header-ctn d-flex justify-content-end align-items-center" style="gap: 20px;">
  <div class="header-ctn" style="display: flex; align-items: center; justify-content: flex-end; gap: 20px;">

<a href="checkout.html" style="display: flex; align-items: center; gap: 6px; color: white; font-weight: 600; text-decoration: none; cursor: pointer;">
  <i class="fa fa-shopping-cart" style="border: 2px solid white; padding: 4px; border-radius: 4px;"></i>
  <span>Mon Panier</span>
</a>

<a href="priserdv.html" style="display: flex; align-items: center; gap: 6px; color: white; font-weight: 600; text-decoration: none; cursor: pointer;">
  <i class="fa fa-calendar" style="border: 2px solid white; padding: 4px; border-radius: 4px;"></i>
  <span>RDV/Devis Gratuit </span>
</a>


  <div class="menu-toggle">
    <a href="#" style="display: flex; align-items: center; gap: 6px; color: white; text-decoration: none;">
      <i class="fa fa-bars"></i>
      <span>Menu</span>
    </a>
  </div>
</header>

<nav id="navigation">
  <div class="container">
    <div id="responsive-nav">
      <ul class="main-nav nav navbar-nav">
        <li><a href="./index.html">Accueil</a></li>
        <li><a href="./produits.html">Produits</a></li>
        <li><a href="./contactus.html">Nous Contacter</a></li>
        <li class="active"><a href="#">Mon Panier üõí </a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
  <h1>Votre Panier</h1>

  <table id="cart-table">
    <thead>
      <tr>
        <th>Produit</th>
        <th>Quantit√©</th>
        <th>Option Pose</th>
        <th>Prix Unitaire</th>
        <th>Sous-total</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>

  <div class="total" id="total-price">Total : 0 ‚Ç¨</div>
  <button id="clear-cart-btn">Vider le panier</button>

  <div class="promo-section">
    <h3>Code Promo</h3>
    <input type="text" id="promo-code-input" placeholder="Entrez votre code promo" />
    <button id="apply-promo-btn">Appliquer</button>
    <div id="promo-message" class="message"></div>
  </div>

  <div class="coords-section">
    <h3>Coordonn√©es</h3>

    <form id="order-form">

      <input type="hidden" name="access_key" value="842eaa2b-86c3-4550-8127-5999fbd0cde7">

      <label for="name">Nom complet *</label>
      <input type="text" id="name" name="name" required />

      <label for="email">Email *</label>
      <input type="email" id="email" name="email" required />

      <label for="phone">T√©l√©phone *</label>
      <input type="tel" id="phone" name="phone" required />

      <label for="address">Adresse *</label>
      <textarea id="address" name="address" required></textarea>

      <label>
        <center>
          R√®glement sur place <br>
          Vous serez inform√© par email de l‚Äôavancement de votre commande ainsi que des d√©lais de livraison.
        </center>
      </label>

      <input type="hidden" id="hidden-total" name="montant_total" value="">

      <button type="submit">Valider la commande</button>
    </form>

    <div id="order-message" class="message"></div>
  </div>
</div>

<footer id="footer">

  <div class="section">

    <div class="container">
      <div class="row">

        <div class="col-md-3 col-xs-6">
          <div class="footer">
            <h3 class="footer-title">A PROPOS</h3>
            <p>Installation Automobile & Esth√©tique Qualit√© pro √† petit prix. <br>
              Offrez une nouvelle vie √† votre voiture ! RDV du lundi au samedi. <br> 8h‚Äì20h. devis gratuit.</p>
            <ul class="footer-links">
              <li><a href="#"><i class="fa fa-phone"></i> +33 7 49 94 41 32</a></li>
              <li><a href="#"><i class="fa fa-envelope-o"></i> contact95190@gmail.com</a></li>
              <li><a href="#"><i class="fa fa-map-marker"></i> Goussainville 95190</a></li>
            </ul>
          </div>
        </div>

        <div class="col-md-6 text-center d-flex align-items-center justify-content-center">
          <h1 style="font-size: 2.0rem; margin: 0; color: white;">
            <br>
          </h1>
        </div>

        <div class="col-md-3 col-xs-6">
          <div class="footer">
            <h3 class="footer-title">LIENS UTILES</h3>
            <ul class="footer-links">
              <li><a href="./index.html">Accueil</a></li>
              <li><a href="./produits.html">Produits</a></li>
              <li><a href="./contactus.html">Nous Contacter</a></li>
              <li><a href="./priserdv.html">Prise de RDV</a></li>
            </ul>
          </div>
        </div>

      </div>
    </div>

  </div>
</footer>

<script>

  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  const cartTableBody = document.querySelector('#cart-table tbody');
  const totalPriceElem = document.getElementById('total-price');
  const clearCartBtn = document.getElementById('clear-cart-btn');
  const promoInput = document.getElementById('promo-code-input');
  const applyPromoBtn = document.getElementById('apply-promo-btn');
  const promoMessage = document.getElementById('promo-message');

  const orderForm = document.getElementById('order-form');
  const orderMessage = document.getElementById('order-message');

  let discountPercent = 0;
  let promoApplied = false;

  function renderCart() {
    cartTableBody.innerHTML = '';

    if (cart.length === 0) {
      cartTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Votre panier est vide</td></tr>`;
      totalPriceElem.textContent = "Total : 0 ‚Ç¨";
      return;
    }

    let total = 0;

    cart.forEach(item => {
      const unitPrice = item.basePrice + item.installationPrice;
      const subTotal = unitPrice * item.quantity;
      total += subTotal;

      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>${item.installationLabel}</td>
        <td>${unitPrice.toFixed(2)} ‚Ç¨</td>
        <td>${subTotal.toFixed(2)} ‚Ç¨</td>
      `;

      cartTableBody.appendChild(tr);
    });

    if (promoApplied && discountPercent > 0) {
      const discount = total * discountPercent / 100;
      total -= discount;
      promoMessage.textContent = `Code promo appliqu√© : -${discountPercent}% (-${discount.toFixed(2)} ‚Ç¨)`;
      promoMessage.className = 'message success';
    } else {
      promoMessage.textContent = '';
      promoMessage.className = 'message';
    }

    totalPriceElem.textContent = `Total : ${total.toFixed(2)} ‚Ç¨`;
  }

  renderCart();

  clearCartBtn.addEventListener('click', () => {
    if (confirm("Voulez-vous vraiment vider votre panier ?")) {
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    }
  });

  applyPromoBtn.addEventListener('click', () => {
    const code = promoInput.value.trim().toLowerCase();

    if (!code) {
      promoMessage.textContent = "Veuillez entrer un code promo.";
      promoMessage.className = "message error";
      return;
    }

    const validPromos = {
      'promo10': 10,
      'promo15': 15,
      'promo20': 20
    };

    if (validPromos[code]) {
      discountPercent = validPromos[code];
      promoApplied = true;
      renderCart();
    } else {
      promoMessage.textContent = "Code promo invalide.";
      promoMessage.className = "message error";
      discountPercent = 0;
      promoApplied = false;
      renderCart();
    }
  });

  orderForm.addEventListener('submit', function(e) {
    e.preventDefault();

    if(cart.length === 0) {
      orderMessage.textContent = "Votre panier est vide, vous ne pouvez pas passer commande.";
      orderMessage.className = "message error";
      return;
    }

    
    const totalText = totalPriceElem.textContent;
    const total = totalText.replace(/[^\d.,]/g, '').replace(',', '.');
    document.getElementById('hidden-total').value = total + " ‚Ç¨";


    let details = "Commande :\n";
    cart.forEach(item => {
      const unitPrice = item.basePrice + item.installationPrice;
      const subTotal = unitPrice * item.quantity;
      details += `- ${item.name} x${item.quantity} (${item.installationLabel}), Prix unitaire: ${unitPrice.toFixed(2)} ‚Ç¨, Sous-total: ${subTotal.toFixed(2)} ‚Ç¨\n`;
    });

    if (promoApplied) {
      details += `Code promo: ${promoInput.value.trim()} (${discountPercent}% de r√©duction)\n`;
    }

    let detailsField = orderForm.querySelector('textarea[name="details_commande"]');
    if (!detailsField) {
      detailsField = document.createElement('textarea');
      detailsField.name = "details_commande";
      detailsField.style.display = "none";
      orderForm.appendChild(detailsField);
    }
    detailsField.value = details;

   
    const formData = new FormData(orderForm);


    fetch('https://api.web3forms.com/submit', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        orderMessage.textContent = "Merci pour votre commande ! Vous recevrez un email de confirmation.";
        orderMessage.className = "message success";
      
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        renderCart();
        orderForm.reset();
        promoApplied = false;
        discountPercent = 0;
        promoMessage.textContent = '';
      } else {
        orderMessage.textContent = "Erreur lors de l'envoi de la commande, veuillez r√©essayer.";
        orderMessage.className = "message error";
      }
    })
    .catch(error => {
      orderMessage.textContent = "Erreur r√©seau, veuillez v√©rifier votre connexion.";
      orderMessage.className = "message error";
      console.error(error);
    });
  });
</script>

</body>
</html>
